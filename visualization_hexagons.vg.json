{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 400,
  "height": 300,
  "background": "black",
  "signals": [
    {
      "name": "current_step",
      "value": 0,
      "bind": {"input": "range", "min": 0, "max": 1500, "step": 1}
    },
    {"name": "rows", "init": "y_extent[1]+1"},
    {"name": "columns", "init": "x_extent[1]+1"},
    {
      "name": "scale",
      "init": "round(100*max(1,width/height))/100",
      "bind": {"input": "range", "min": 0, "max": 2},
      "on": [
        {
          "events": "view:mousewheel",
          "update": "round(max(0, min(2, scale + (event.wheelDelta > 0 ? 0.1 : -0.1)))*100)/100"
        }
      ]
    },
    {"name": "hexalength", "update": "sin(PI)"},
    {"name": "sizeref", "init": "min(width,height)"},
    {"name": "sizeSymbol", "update": "bandwidth('hscale')"},
    {"name": "hcl_white", "init": "hcl('white')"},
    {
      "name": "visualization",
      "value": "umatrix",
      "bind": {"input": "select", "options": ["iso", "umatrix", "classes"]}
    },
    {"name": "showClasses", "update": "visualization === 'classes'"},
    {"name": "showIso", "update": "visualization === 'iso'"},
    {"name": "hivewidth", "update": "sizeSymbol*columns"}
  ],
  "data": [
    {
      "name": "neurons",
      "format": {
        "type": "dsv",
        "delimiter": ";",
        "parse": {
          "x": "number",
          "y": "number",
          "z": "number",
          "step": "number",
          "score": "number",
          "secondary": "number",
          "class": "number",
          "stabilized": "number",
          "score1": "number",
          "score2": "number"
        },
        "header": [
          "vector",
          "x",
          "y",
          "z",
          "step",
          "score",
          "class",
          "secondary",
          "stabilized",
          "score1",
          "score2",
          "entries"
        ]
      },
      "url": "https://raw.githubusercontent.com/mtiberghien/DNF1ED01-SOM/master/som2D_n.data?token=ASL2ZNPPNMRLJPHNVPYECPDALDK64",
      "transform": [
        {"type": "extent", "signal": "steps", "field": "step"},
        {"type": "filter", "expr": "datum.step === current_step"},
        {"type": "extent", "field": "y", "signal": "y_extent"},
        {"type": "extent", "field": "x", "signal": "x_extent"},
        {"type": "extent", "field": "score", "signal": "scores"},
        {
          "type": "formula",
          "expr": "split(replace(replace(datum.vector, '[',''),']',''),',')",
          "as": "vector"
        },
        {"type": "formula", "expr": "datum.x+'.'+datum.y", "as": "id"}
      ]
    },
    {
      "name": "umatrix",
      "source": "neurons",
      "transform": [
        {"type": "project", "fields": ["x", "y", "vector"]},
        {
          "type": "formula",
          "expr": "sequence(datum.x-1,datum.x+2,1)",
          "as": "nx"
        },
        {
          "type": "formula",
          "expr": "sequence(datum.y-1,datum.y+2,1)",
          "as": "ny"
        },
        {"type": "flatten", "fields": ["ny"]},
        {"type": "flatten", "fields": ["nx"]},
        {
          "type": "filter",
          "expr": "datum.nx >= 0 && datum.ny >=0 && datum.nx < columns && datum.ny < rows && (((datum.y%2 === 1 && datum.nx < (datum.x+1)) || (datum.y%2 === 0 && datum.nx > (datum.x-1))) || datum.ny === datum.y) && (datum.nx !== datum.x || datum.ny !== datum.y)"
        },
        {"type": "formula", "expr": "datum.nx+'.'+datum.ny", "as": "nid"},
        {
          "type": "lookup",
          "key": "id",
          "from": "neurons",
          "fields": ["nid"],
          "values": ["vector"],
          "as": ["nvector"]
        },
        {"type": "flatten", "fields": ["vector", "nvector"]},
        {
          "type": "formula",
          "expr": "pow(datum.vector - datum.nvector, 2)",
          "as": "d"
        },
        {
          "type": "aggregate",
          "fields": ["d"],
          "ops": ["sum"],
          "groupby": ["x", "y", "nx", "ny"],
          "as": ["d"]
        },
        {"type": "formula", "expr": "sqrt(datum.d)", "as": "d"},
        {
          "type": "aggregate",
          "fields": ["d"],
          "ops": ["mean"],
          "groupby": ["x", "y"],
          "as": ["d"]
        },
        {"type": "formula", "expr": "datum.x+'.'+datum.y", "as": "id"},
        {
          "type": "lookup",
          "from": "neurons",
          "key": "id",
          "fields": ["id"],
          "values": ["class", "secondary", "score", "score1", "score2"]
        }
      ]
    },
    {
      "name": "contours",
      "values": [
        {
          "width": 40,
          "height": 40,
          "values": [
            0.05018728803370535,
            0.06578721925512696,
            0.06410216213566101,
            0.06807409314515961,
            0.0737390249486305,
            0.06241726978591196,
            0.06568227684665749,
            0.08271773194310553,
            0.07793500434656775,
            0.06785736477708898,
            0.09203744066179363,
            0.09934888312727569,
            0.08363305307796733,
            0.09666267368506641,
            0.09246804338165576,
            0.0727806040856502,
            0.055837149947482415,
            0.08478820605521892,
            0.11249979133484739,
            0.098497539648352,
            0.07185349353546477,
            0.08821829459915992,
            0.10171707842362142,
            0.07006897591769944,
            0.08613418247695835,
            0.10022398139148549,
            0.06594485505477331,
            0.06482639079756466,
            0.08076346023628285,
            0.07878831478237351,
            0.09881118187876804,
            0.09769934818739695,
            0.08394298672504866,
            0.0745455262417079,
            0.08033940468500567,
            0.10775800597122424,
            0.09794518344357096,
            0.07502705518690603,
            0.06019261605852505,
            0.050838090407895394,
            0.061825994983794055,
            0.07436785515105779,
            0.08263341514328643,
            0.07785276617644524,
            0.08161636608668013,
            0.07171801910543563,
            0.06195320849123085,
            0.07469286805010174,
            0.09113563346860545,
            0.08653130091237833,
            0.09010429004569795,
            0.09773590982735052,
            0.08811177458336367,
            0.08867133356731471,
            0.10099089318800436,
            0.08452294428385,
            0.06565751153441349,
            0.06690452382180577,
            0.09968236589639565,
            0.10680331003390131,
            0.08769942032933777,
            0.08356856701148006,
            0.10054015931451188,
            0.09599517916702718,
            0.08431672532243327,
            0.1057509064136066,
            0.10165265276957282,
            0.07692672970259985,
            0.08765363458607099,
            0.08771547966510317,
            0.09108502362037682,
            0.10936057997312787,
            0.09808083814739073,
            0.08774233310187231,
            0.08318220072810491,
            0.09209382496750947,
            0.1061203676998007,
            0.08696154610585727,
            0.07815043930623611,
            0.0740637878710488,
            0.08003802482679265,
            0.0896392843561402,
            0.09676529522590892,
            0.09505209252994504,
            0.07933113964339371,
            0.07526323842105312,
            0.07566655603820646,
            0.07687646442697864,
            0.08969322285730158,
            0.10000149586182258,
            0.10705733872245576,
            0.09741898628007176,
            0.08793386815219743,
            0.09552702019966094,
            0.10528949166961545,
            0.08715788636791263,
            0.07849733951537213,
            0.1003225982600532,
            0.11336267990939129,
            0.10729510609897543,
            0.10302523592543544,
            0.11075205755943629,
            0.11331073221546503,
            0.10906541428750988,
            0.11070952287754811,
            0.11786383095981971,
            0.10160730320370809,
            0.08923150024201335,
            0.10633764743785117,
            0.10138192535490644,
            0.10453173079700354,
            0.1024192672394199,
            0.09736172312128741,
            0.08484152761669951,
            0.08549222790646921,
            0.10424252896016341,
            0.09378387107536554,
            0.09131041731396732,
            0.08207153131525091,
            0.07530897071986208,
            0.07830488670687547,
            0.08716349081980838,
            0.1052625122728225,
            0.1103622486804427,
            0.0931977091721557,
            0.0814777222170775,
            0.09375128246889114,
            0.09112417106670621,
            0.08122066855964631,
            0.0894802138491588,
            0.10233356958961533,
            0.10841396660489605,
            0.0962200614907674,
            0.09001380263984915,
            0.09755496883294434,
            0.10430201693532237,
            0.09041013230240483,
            0.09232786386855273,
            0.10295040899566116,
            0.10735426979466337,
            0.11083307430116862,
            0.10808675312341548,
            0.11426459270255392,
            0.0976103568373037,
            0.10275283932148879,
            0.10573696249232947,
            0.11427787028323977,
            0.09762155012956425,
            0.10948012596257864,
            0.12574439277194344,
            0.10533486494444336,
            0.09307533632777198,
            0.08884837229647148,
            0.07869431293642283,
            0.07663540688143719,
            0.09221789255413121,
            0.0996213740403222,
            0.09143644294585254,
            0.08647487586310018,
            0.08721706443871098,
            0.10789689334091238,
            0.10074949573671016,
            0.11713379008258949,
            0.11527190342560364,
            0.09382509411667113,
            0.10579019578274058,
            0.10629324937936588,
            0.09086971734431691,
            0.08204040114767064,
            0.09115228706050893,
            0.09899960756867947,
            0.08678593059032114,
            0.09150833255764695,
            0.08981724451609373,
            0.10379549121516332,
            0.1029118400109329,
            0.09327321520413911,
            0.09297090385634828,
            0.10237493053781235,
            0.11688375631615332,
            0.10629883686722794,
            0.11019783818998863,
            0.09656972827925658,
            0.10029350613052816,
            0.10149757883946703,
            0.11114404753142247,
            0.11431003566595906,
            0.1054267284082844,
            0.11517717201743577,
            0.09824164613817582,
            0.08788814406541032,
            0.08475766010883284,
            0.0766538565856088,
            0.07072780874104422,
            0.08191488510743122,
            0.08375557610563411,
            0.0869062641890209,
            0.08276457006321028,
            0.07241566363179286,
            0.06555710541470992,
            0.07692369395892111,
            0.08427453167498819,
            0.1040694505256483,
            0.123456589200959,
            0.10700960507367951,
            0.09281727661541236,
            0.11068810291265985,
            0.08937177988296308,
            0.07904185372354078,
            0.08677838602775163,
            0.09493941081780448,
            0.08784974665568691,
            0.0835338725785227,
            0.09286265984004566,
            0.09506499465263646,
            0.10225141314438091,
            0.10516060159124282,
            0.11723721258038461,
            0.12950365721978688,
            0.13943575399972913,
            0.1380358372393807,
            0.12783452822089753,
            0.11937423641605249,
            0.12475992606119446,
            0.13532187789353112,
            0.13221614632031314,
            0.1261830429692534,
            0.10966045594291385,
            0.1022874924848794,
            0.09553060742483438,
            0.0813405682563389,
            0.09134204025685283,
            0.08555695399951747,
            0.0768920885489271,
            0.07894078538468986,
            0.08618993419634562,
            0.08628189686451303,
            0.07902890523906822,
            0.07122895484799921,
            0.07103746777089684,
            0.062086453266220226,
            0.07535288943459079,
            0.11827425653806811,
            0.11807984632884494,
            0.08625756886943851,
            0.09984065682553073,
            0.09299242745213432,
            0.07709314352246639,
            0.08398870143068243,
            0.09674407025625187,
            0.1007762501490479,
            0.09502227142507899,
            0.0952655682521287,
            0.09961260760663132,
            0.10862833524849101,
            0.11600216483287079,
            0.12136700069670649,
            0.13260075330165663,
            0.14692559758965865,
            0.14659615921351424,
            0.13790636460814107,
            0.12894787898293117,
            0.12277171510141435,
            0.12967656423188617,
            0.13547462776344507,
            0.14180266526674246,
            0.12180759987755288,
            0.11543814665940179,
            0.11661509265207705,
            0.09814906347408897,
            0.09771320907064657,
            0.09968683327832223,
            0.08756666365224691,
            0.07710728478483272,
            0.0842462262025594,
            0.09718803740482285,
            0.08613103668228023,
            0.07955759251063187,
            0.07285808402863948,
            0.07087539509366192,
            0.05030294648497131,
            0.059481756583350975,
            0.0829372013731082,
            0.11431792145266025,
            0.09415706777963732,
            0.07240874745098527,
            0.09347424311267657,
            0.07955181374665213,
            0.07912982821663059,
            0.09004046541889928,
            0.09877592422872387,
            0.09612595094650848,
            0.08257002455650829,
            0.08087292917981125,
            0.08581405696939488,
            0.0984813346755483,
            0.10210548912356507,
            0.096560379609654,
            0.10316634542200843,
            0.10945498898994538,
            0.10951258986156162,
            0.10567496656402792,
            0.0992716979128451,
            0.09134214976470045,
            0.08932847664645413,
            0.09349049106472647,
            0.10864467539280454,
            0.0981695065332449,
            0.10237108786400693,
            0.09345878254928133,
            0.09344000513962589,
            0.09989782500929846,
            0.09899659455032256,
            0.09770812899516079,
            0.09551794755710552,
            0.09569201477496665,
            0.09592176712849698,
            0.06808561057939526,
            0.05735942081102008,
            0.0562981117356202,
            0.061284491729703655,
            0.05981161175907411,
            0.09863864673519801,
            0.10666501383226301,
            0.07340148826497608,
            0.09084694327951211,
            0.10031101786619812,
            0.09626538695585796,
            0.10189139661224503,
            0.10902335656291726,
            0.10701734131906834,
            0.09474151032913825,
            0.08752034785020261,
            0.08419125450456182,
            0.08612731049056165,
            0.10373985574935826,
            0.09497620225365051,
            0.0903657798319092,
            0.08910069791867521,
            0.0914077720044742,
            0.09641461831228354,
            0.09139153900885409,
            0.09055722339441649,
            0.08415326397034559,
            0.0706093431747858,
            0.08857999154683069,
            0.09185283018886849,
            0.09389832369506856,
            0.09517905752345898,
            0.08231891231435848,
            0.09185229099174552,
            0.09847098119241668,
            0.09667544540496446,
            0.09486511661878907,
            0.0936736437860676,
            0.09589946741420674,
            0.07439829175262717,
            0.05790929109087004,
            0.04664886907654276,
            0.04227319561171807,
            0.0811952359341022,
            0.08328251735013176,
            0.09465288490076071,
            0.11562038957735056,
            0.1055076968048026,
            0.09302320083185874,
            0.11043115098899178,
            0.10877510876238884,
            0.10540057168241994,
            0.11616951999012551,
            0.11864018495261325,
            0.11574091891487207,
            0.10683134130963191,
            0.0935449902379809,
            0.0902049379790877,
            0.10029954138566913,
            0.1064010735521567,
            0.09902492236887589,
            0.10072846135691071,
            0.08586813692763277,
            0.08476755451588608,
            0.08772715114945133,
            0.09491414993224913,
            0.10134740779201551,
            0.09455454181699652,
            0.09105954749100235,
            0.09431034848409615,
            0.08552705382642783,
            0.0920812655349296,
            0.0811326341947554,
            0.0650973358928322,
            0.07788268606229522,
            0.07425512261927958,
            0.07039869522314955,
            0.07734246923413995,
            0.0884736581059237,
            0.09710975041023201,
            0.08160090015477503,
            0.0724605509289366,
            0.07233665701253204,
            0.09268964421567981,
            0.08629475074793584,
            0.09684583196344185,
            0.0998310384243679,
            0.09218273199579465,
            0.09912858607757191,
            0.10450724965124018,
            0.09159874746588426,
            0.08748073069057213,
            0.09730854569988823,
            0.10042515528275262,
            0.10411007871077659,
            0.09037083816103524,
            0.08552895335036376,
            0.08130755012284958,
            0.08528295357879465,
            0.08592343502241476,
            0.08877318846427132,
            0.08513091696163459,
            0.0769684428069699,
            0.0712440883259896,
            0.08298235214422091,
            0.10030885642804138,
            0.11144656653869536,
            0.10725663701427253,
            0.09887674839780268,
            0.08715978608103438,
            0.08952997375111282,
            0.08868684904137372,
            0.06707960841690049,
            0.07438614689921628,
            0.07446291317149427,
            0.06547578622658187,
            0.07093317996382383,
            0.07835818146902318,
            0.08974442120228229,
            0.09109325078145472,
            0.08186054271533019,
            0.06611249781636003,
            0.05900997198207208,
            0.07412543741618345,
            0.08423532687823043,
            0.09958548950917069,
            0.09129258296206763,
            0.06755701591377583,
            0.07311749700259593,
            0.09103017036424338,
            0.09160415892899845,
            0.0741879636454848,
            0.07872297756734718,
            0.09296353200238743,
            0.10202301689801113,
            0.10713981877727444,
            0.1002425165975136,
            0.09437347952223113,
            0.07970120109189288,
            0.085873981861269,
            0.08652989709411928,
            0.09362702895878261,
            0.10004719669650176,
            0.09869129617734256,
            0.08828670307964019,
            0.08612872094069401,
            0.10462303904415458,
            0.11341680776381356,
            0.10287543150590651,
            0.09328329356528778,
            0.08772539653284817,
            0.08136310264857274,
            0.0825306815905828,
            0.07406628474400433,
            0.08227356199029456,
            0.07371247587987195,
            0.07226007034175508,
            0.07613813890433334,
            0.08639625660967674,
            0.09802538544014144,
            0.09011228144889845,
            0.07373768991672643,
            0.0705136178358777,
            0.0925301280337274,
            0.09705715135576293,
            0.10323596349615727,
            0.08471334252199182,
            0.08001822150102592,
            0.09070762551243794,
            0.0972293990394178,
            0.08142697448264288,
            0.07032915927484766,
            0.08012632391778675,
            0.0898947629163676,
            0.10060758010014362,
            0.10453248331091214,
            0.1022291702956939,
            0.096507482493135,
            0.08902568875395245,
            0.08607763389210213,
            0.09485263813886324,
            0.09927406541809244,
            0.10200395823665617,
            0.10040733864387331,
            0.09710431806084809,
            0.09546792941422241,
            0.10470618272176391,
            0.09684982879285356,
            0.0789424865748021,
            0.07014243036856302,
            0.06823618796980857,
            0.08047287908607731,
            0.07705567040113308,
            0.07760053208145151,
            0.07328113250224684,
            0.07489913099709929,
            0.0811626479124395,
            0.08073140578948587,
            0.0913437935119523,
            0.10068764059404596,
            0.0866750066209272,
            0.07792331933765813,
            0.07338513679966609,
            0.0816897437696243,
            0.08647790795060219,
            0.09783013652520471,
            0.10419432471903783,
            0.09879073659747097,
            0.09527220295570157,
            0.10372681641212629,
            0.0991141817372061,
            0.07978491640264514,
            0.07326053934496857,
            0.0726832145151182,
            0.07284753228243818,
            0.08384846572748704,
            0.09566383516638614,
            0.10547288647888249,
            0.10504876834470003,
            0.0910401617788831,
            0.08613933831668644,
            0.08111564751084686,
            0.08308117044905579,
            0.08561354082596757,
            0.09249988341825437,
            0.09969130090860284,
            0.09406710431190174,
            0.09592429374225611,
            0.07982061736326909,
            0.06780345044396992,
            0.07219497211976612,
            0.08508813408509672,
            0.09683212924192429,
            0.08304821652730726,
            0.07809344819344297,
            0.07292129346354526,
            0.0757710901838008,
            0.0703852694809361,
            0.06284079075788884,
            0.07668360521878645,
            0.0728851765314748,
            0.06841109837391172,
            0.07499038356312626,
            0.08159831731951439,
            0.0801990894676761,
            0.09197338387038065,
            0.09296219296713368,
            0.08669964570287304,
            0.11331996274894698,
            0.11195840875952019,
            0.08858983450957457,
            0.08233741853682966,
            0.07513289542001625,
            0.06950967393404864,
            0.07072282189052445,
            0.08006840791285888,
            0.09628734372707064,
            0.1090554011582951,
            0.10186330553441741,
            0.0879877260720872,
            0.08013234258287522,
            0.07941947918731448,
            0.08611533760939549,
            0.09177780074884997,
            0.10567738032424623,
            0.09759829197344275,
            0.09891162861880959,
            0.09640222614078213,
            0.08971625756681838,
            0.09252894101105796,
            0.09883009089360352,
            0.10357365544425699,
            0.08246132231087915,
            0.07977276850109014,
            0.07517395995576759,
            0.0746904338829473,
            0.07248134624087525,
            0.0639504427355433,
            0.06730108792147742,
            0.06913040962966972,
            0.058886269887734134,
            0.060619088804122395,
            0.053406434988117674,
            0.06485232380160838,
            0.06911898236599914,
            0.08257011293814333,
            0.08789866013640446,
            0.07801475873051676,
            0.0888118008078163,
            0.12757231310548264,
            0.08406031920016953,
            0.07473458257955946,
            0.07807101755511617,
            0.07621416509662016,
            0.07460142445945611,
            0.07572277107752978,
            0.07765169095938519,
            0.08997414032401364,
            0.10095115153955218,
            0.09424270397914657,
            0.08702984452901598,
            0.08290408145997118,
            0.08588126520117165,
            0.09069739047986693,
            0.09775743328074837,
            0.10416569608568475,
            0.09299176821428061,
            0.09334742609034659,
            0.0868177924001207,
            0.08682024512485942,
            0.09476926604845243,
            0.09420164108244354,
            0.0755658920063534,
            0.0717149293628462,
            0.08134365453322771,
            0.08166821329485802,
            0.08753209792377305,
            0.07809237659312676,
            0.06804589156807098,
            0.06477691624133125,
            0.056139025835354996,
            0.04837421022458346,
            0.051492161082579,
            0.0872197295293292,
            0.08461281064131873,
            0.0969456323931048,
            0.09691872255345799,
            0.0783356278273442,
            0.11697086553103707,
            0.0987585281593592,
            0.07967839152629333,
            0.08572076046872779,
            0.09085035609002247,
            0.09655811669292609,
            0.09850285877494314,
            0.09386981375971579,
            0.0885293516663632,
            0.10021006025473299,
            0.09736788429999524,
            0.09631475051326657,
            0.09977501967547589,
            0.09498441599858305,
            0.09278781520086204,
            0.09701959835287122,
            0.10635963207451589,
            0.0969899037746669,
            0.09246277069366136,
            0.09085718070968297,
            0.08170730320435088,
            0.08180379687430472,
            0.08854939668738337,
            0.07352595865840166,
            0.06708556198254904,
            0.07848876806802381,
            0.08766851864168228,
            0.10045954095783638,
            0.08848280744641418,
            0.06733991279643461,
            0.059134761114375475,
            0.059332488753791386,
            0.05677091495423,
            0.06150695364735822,
            0.05461327049973639,
            0.07836677633279544,
            0.08278622696425593,
            0.09436326152762312,
            0.10243333179008546,
            0.09588539155851084,
            0.09082490823150592,
            0.1193326192161917,
            0.08729795294880269,
            0.07458151737530595,
            0.07924429850964156,
            0.09020454628804686,
            0.10220243881497232,
            0.1029956225302197,
            0.09978207083532584,
            0.10035047934859634,
            0.09652838028850654,
            0.09780498622617394,
            0.11371906970117171,
            0.12252771242362857,
            0.10904610339356959,
            0.10079541223853841,
            0.10019474808908609,
            0.09397881810378872,
            0.09821005441697722,
            0.10578228968016827,
            0.09979669277385866,
            0.09103592821547092,
            0.09338793257937329,
            0.09315679602598256,
            0.08204264792767335,
            0.08731134599378154,
            0.09287398553654316,
            0.09688435593252163,
            0.09290696501297524,
            0.07709124939020613,
            0.06638058203800248,
            0.06545589094905205,
            0.06999218880445221,
            0.07360505645069433,
            0.07400511701390024,
            0.06447405700100944,
            0.06920401277911356,
            0.10163432687666414,
            0.11222665172646278,
            0.08602892918100015,
            0.10989498546070861,
            0.10082788629985803,
            0.07093888526128747,
            0.07452897401892296,
            0.07960117595558729,
            0.09248941602363189,
            0.10565771021588996,
            0.106225597593467,
            0.10430864444033856,
            0.10685639436319427,
            0.11382450652287707,
            0.11286855912045696,
            0.12639485279351953,
            0.12029509470564699,
            0.09820421990082835,
            0.0937415076483107,
            0.0837621187687988,
            0.08627996906890101,
            0.09474380990752587,
            0.09745986645570752,
            0.0919890595389236,
            0.09389556800220547,
            0.10213726274118509,
            0.10174593289815893,
            0.09988866829151598,
            0.09715315820209477,
            0.0988107816055298,
            0.091405483829098,
            0.0813797020826918,
            0.07403904589623761,
            0.07750224938396871,
            0.09202994413272535,
            0.0922114678780096,
            0.07741658035536535,
            0.06890639760724153,
            0.04288134382977536,
            0.049458892786864515,
            0.06940805921374908,
            0.10462112988033376,
            0.09186456585062121,
            0.07666778449861172,
            0.11337041909016601,
            0.08658284198951158,
            0.07586591066857314,
            0.09152202058081167,
            0.0937619778434174,
            0.11051967362079976,
            0.10961920876236361,
            0.11570736656581095,
            0.1270806262037065,
            0.12220895211146936,
            0.10496364377762099,
            0.08939225822849058,
            0.09836191055064054,
            0.08317248961739424,
            0.08398443871814673,
            0.09083783538431454,
            0.08526659665265408,
            0.08804106427070305,
            0.07846686762407834,
            0.0881622796111344,
            0.08591748009475633,
            0.10071102922690754,
            0.1010250674310029,
            0.10098749699379739,
            0.09744404804073648,
            0.09813322150459194,
            0.10319223681954606,
            0.08354267310715277,
            0.08135979183417369,
            0.07109859395782103,
            0.08849262090091983,
            0.10006562604208488,
            0.09046530913942494,
            0.08341175601424297,
            0.060795828187001966,
            0.05676682667874951,
            0.08139262199136456,
            0.0933471369828302,
            0.06371386926983268,
            0.09586589598255685,
            0.09680591643354983,
            0.07000931700403804,
            0.08297245092103422,
            0.10047582458911658,
            0.09865721971212084,
            0.09349347860259341,
            0.09920867964365478,
            0.11580622671090281,
            0.1328649647831279,
            0.11704935114913825,
            0.07901068582417287,
            0.07824487191948204,
            0.07509413160191673,
            0.06781777184979931,
            0.08203966753738687,
            0.07997339735899532,
            0.08959794517584216,
            0.07243639195771238,
            0.08173498757898712,
            0.07003430925091075,
            0.07702913964909441,
            0.07692292637757449,
            0.07432883260056874,
            0.08523932226634431,
            0.0750583635786163,
            0.1017197077541061,
            0.09735827026910401,
            0.0932023903341743,
            0.08543111085021288,
            0.09255832562786181,
            0.10472638721484454,
            0.09350028635323267,
            0.08667772158423895,
            0.08135716044523889,
            0.08833225751988102,
            0.089226130830718,
            0.09263612655853805,
            0.08538348943629327,
            0.0784683443758063,
            0.06618659972010088,
            0.09580862137270758,
            0.07027034659442703,
            0.05472426193592037,
            0.09157204423057999,
            0.09955912328429178,
            0.07023603142426811,
            0.0671425331517324,
            0.09246221569711796,
            0.11455834538590093,
            0.11922183571953258,
            0.09926939943778687,
            0.07548583853609439,
            0.07701090363314482,
            0.06781607510337855,
            0.07266016380253729,
            0.08713463558013389,
            0.08187373048132457,
            0.09352433937546885,
            0.08273771381131088,
            0.08859484516854607,
            0.07416190184748252,
            0.07514918991555153,
            0.05888097835770067,
            0.07474453322590868,
            0.08319314970540782,
            0.0789078503822427,
            0.10643535336381077,
            0.09272931309921174,
            0.09364941754150559,
            0.09324019370267589,
            0.10819020863715004,
            0.10002022924594597,
            0.08566041612155886,
            0.09290225331625977,
            0.10077174517867646,
            0.08654117213215488,
            0.09100874235742232,
            0.0904177542920304,
            0.06891523328483895,
            0.09352160492779149,
            0.09943706873826165,
            0.07153184712859784,
            0.08393201993070651,
            0.10214087261619191,
            0.08165370281740202,
            0.059407830187142616,
            0.058207592690320886,
            0.09318848955742927,
            0.12245048486250242,
            0.11280217358249603,
            0.08809822114027187,
            0.08433374775005029,
            0.0756982891855459,
            0.07214635053328647,
            0.09751655351905757,
            0.08973760747345699,
            0.09814403639456803,
            0.08883473399107256,
            0.09566478690240854,
            0.08693614955011063,
            0.08621308568441824,
            0.07384315312205562,
            0.0744297550870547,
            0.09058365321388687,
            0.07621711351167347,
            0.1004930669820909,
            0.10710090514447371,
            0.11183835148850989,
            0.11050959109813052,
            0.10986264801743288,
            0.10830263983536145,
            0.10116719891794183,
            0.10047167813671341,
            0.096378440215405,
            0.05389553873911454,
            0.05955064072562067,
            0.07300642193192663,
            0.08716297602699236,
            0.0726563712419556,
            0.07905710252947593,
            0.11108696734649927,
            0.08944541786916546,
            0.07690047379671083,
            0.09646192630882075,
            0.10433662801744603,
            0.07706311009769645,
            0.06198505224974713,
            0.06652915899158995,
            0.08922430834970269,
            0.1169402591798443,
            0.10637128581366195,
            0.09619205386943017,
            0.0948534198136074,
            0.0887495457840088,
            0.09964964664715825,
            0.1027185130962191,
            0.0946815004312008,
            0.09763500294630843,
            0.09157952489707828,
            0.10148543455609721,
            0.09105689722998177,
            0.09201803647245373,
            0.08800060258299953,
            0.09687336645983798,
            0.09525959821050314,
            0.09384924011232072,
            0.10887463126955929,
            0.11555452167495922,
            0.12074466952710354,
            0.12953022172153503,
            0.13483695891107883,
            0.12740501983656574,
            0.11972275199006871,
            0.12041626132694266,
            0.08716538596110607,
            0.08849047456045508,
            0.10361305925716041,
            0.09126784280944142,
            0.08294723139180361,
            0.10734149127579513,
            0.0903479235272319,
            0.06236914075995987,
            0.06775366310596428,
            0.09443328076452974,
            0.0988136593311209,
            0.09446228647496818,
            0.09609592812428602,
            0.09236011644595106,
            0.11265110976275128,
            0.09871678157262906,
            0.09194758052434561,
            0.08709445016997905,
            0.07976300491507597,
            0.08690810966638923,
            0.09205806923210154,
            0.0856491398842279,
            0.09997879798730956,
            0.09986560534945932,
            0.10094256683004343,
            0.09381015375609104,
            0.09273700655515042,
            0.08689976466597536,
            0.09198749687173981,
            0.10593737679936142,
            0.10440784021932212,
            0.09971308093194649,
            0.10588598896553546,
            0.10089434679266493,
            0.10031472803608142,
            0.11250834872313956,
            0.11442781265929927,
            0.1110678772157542,
            0.09030476783355985,
            0.07162432609892432,
            0.08527882009307129,
            0.09253368451873563,
            0.1018013566869837,
            0.1039761282848898,
            0.09027756912473694,
            0.09456095537401371,
            0.10258487124464002,
            0.07687184986769731,
            0.0664888974159232,
            0.08659756766143528,
            0.10334318133955277,
            0.10623340812185886,
            0.10607433487451348,
            0.10578365334092127,
            0.1040180252615187,
            0.09057758601468079,
            0.08586941568469304,
            0.08011502156076228,
            0.07081178822214038,
            0.07492572932297703,
            0.08394530751877477,
            0.09153140034029011,
            0.09951771292162559,
            0.10934347675430868,
            0.10422874768977111,
            0.09307485714476699,
            0.08719210238553526,
            0.08786874068450273,
            0.0954214896939069,
            0.1148046114869256,
            0.11917960261755811,
            0.11532828722655768,
            0.11383873671332244,
            0.1044539843641954,
            0.08280910079209283,
            0.08204428360249513,
            0.06955515784684305,
            0.0770177430839846,
            0.08275465383150672,
            0.06477647870641708,
            0.08588591949766705,
            0.08045974889844959,
            0.08956953510952019,
            0.08707820836646053,
            0.07980578037031982,
            0.09488046461524531,
            0.08976015854912063,
            0.0742411294447255,
            0.08098378870487159,
            0.0957108936131808,
            0.10402156232769307,
            0.09590733784748327,
            0.08486048174986514,
            0.07718023877745142,
            0.06939838047512045,
            0.07823884081728695,
            0.0846020819695041,
            0.09096803786250185,
            0.09615945516582258,
            0.0920134070865945,
            0.09718119225718444,
            0.10610324117154261,
            0.10829424514335245,
            0.10282200707393437,
            0.10335949626675979,
            0.09079102917972762,
            0.09531012731552611,
            0.10863432818088806,
            0.12238148647499206,
            0.12596763668681912,
            0.11791091076582452,
            0.10397318710998031,
            0.10657658532791221,
            0.08671740686063774,
            0.0747750217843363,
            0.05759915103086606,
            0.05414147889614844,
            0.08675605360130323,
            0.08538072242122625,
            0.06404310625827285,
            0.06870887949440314,
            0.07160973805330431,
            0.07751623185626355,
            0.08587652145252456,
            0.08415578981369379,
            0.07884168665573893,
            0.09716844349819954,
            0.09179079038520711,
            0.08954127236680239,
            0.09605832860281237,
            0.10697958109812776,
            0.11301500747922932,
            0.10254563992380503,
            0.08114901297117204,
            0.07123612194020178,
            0.07797671808071709,
            0.09500393628535378,
            0.08770441906934999,
            0.08689145249372231,
            0.08710344151968341,
            0.08555732289820525,
            0.09629469602456056,
            0.09518686588712925,
            0.09476360064564009,
            0.1063003128484285,
            0.11072996377258874,
            0.10363266183479652,
            0.11745119014944955,
            0.11449935247691219,
            0.1178906785920014,
            0.10128874814146674,
            0.09499748699969938,
            0.09265160947395873,
            0.10189826385902442,
            0.08528549890257632,
            0.08199225620020548,
            0.07726525802981993,
            0.09531336145203662,
            0.11215799320033096,
            0.1092925811660736,
            0.06284481011666779,
            0.06110546132301929,
            0.08030677034564379,
            0.08950547195573572,
            0.07923304343009646,
            0.09868396380960381,
            0.10402067186551851,
            0.10302052437042303,
            0.10737460023501634,
            0.11131097783602362,
            0.11644677544310592,
            0.11578901153109172,
            0.11069295219400654,
            0.08406242497866862,
            0.07625029908783301,
            0.09468139574711562,
            0.10004494186266444,
            0.08483353385967277,
            0.07887988091352476,
            0.07835730819037534,
            0.0911794472074066,
            0.08782579543126257,
            0.07914382925790914,
            0.09818888284237094,
            0.12138709876198939,
            0.10809608270889365,
            0.13626798908885077,
            0.13031171761974245,
            0.1172002884327379,
            0.08914029873954092,
            0.08248947708750529,
            0.08907639379589878,
            0.10845405878788772,
            0.10638626158391543,
            0.10109472386315584,
            0.12726303030380623,
            0.14830771326300882,
            0.14999997510789603,
            0.13121789729389102,
            0.11856215058676445,
            0.06466819523017782,
            0.06753825297118624,
            0.0783073071312994,
            0.09377175878015434,
            0.09225854015861665,
            0.08632493383906986,
            0.11129591169777975,
            0.09220357120400989,
            0.10117830568516861,
            0.10722606858554995,
            0.10639791671161627,
            0.11088313456764018,
            0.12209541735185153,
            0.12366672864709603,
            0.08951773161819429,
            0.07877460659362241,
            0.09680968645910344,
            0.09554248296769143,
            0.09261931422671542,
            0.08581509281461959,
            0.08465203075542263,
            0.08596961839686668,
            0.07328182924453219,
            0.08360763619232255,
            0.11089480500570123,
            0.1145617603820539,
            0.1157303893051934,
            0.14861058207178388,
            0.10818673842338933,
            0.09271557420707412,
            0.08011466365927594,
            0.08794068605078106,
            0.09450697653441406,
            0.11612949030709252,
            0.12248999273172569,
            0.13083309193717407,
            0.15335740044115256,
            0.15258791283685133,
            0.13462770576168528,
            0.12539614443833727,
            0.08082480153314567,
            0.08258665251114475,
            0.10079696146840925,
            0.10962194723325042,
            0.0861040127818516,
            0.11516628991649863,
            0.09782459340692688,
            0.07939782936379525,
            0.09944011394349282,
            0.09682967290949683,
            0.10218178210292103,
            0.11302790813003132,
            0.14423978446618446,
            0.136359548317739,
            0.11724081570797958,
            0.12837975033753174,
            0.11822976723109639,
            0.11302038963628207,
            0.10626956846586165,
            0.09018167247574159,
            0.0905292484563904,
            0.09462046498114199,
            0.09572671874313061,
            0.10649624844830533,
            0.11870901898630018,
            0.10565404126190547,
            0.15081437366140926,
            0.10659682823688411,
            0.08646207535432558,
            0.08901860771012417,
            0.0974200101001156,
            0.07942714897604755,
            0.09057381677703996,
            0.11908018954330987,
            0.1211917777776331,
            0.12699006078979674,
            0.12740194037985034,
            0.1161877712050956,
            0.09357003635885469,
            0.08163750842891039,
            0.0815163040692224,
            0.08708622959520365,
            0.1002417012112946,
            0.12516526730888988,
            0.11904039642612475,
            0.09204198628354422,
            0.11469138427010833,
            0.06237465339978445,
            0.06910581844509547,
            0.08914242030409225,
            0.08127221617269972,
            0.08815940256882954,
            0.10159453036870436,
            0.11969906458052282,
            0.10994530788980045,
            0.13727281184002293,
            0.14264122471365673,
            0.1125248374910554,
            0.11534336716301058,
            0.10748183312611445,
            0.09109885496487469,
            0.09403775332461747,
            0.09678386831709024,
            0.09009662019136022,
            0.09975614315497015,
            0.0990035511117346,
            0.10521885589146039,
            0.1391281901232574,
            0.07913171527479257,
            0.08091964727670353,
            0.09249643842748768,
            0.08868423580522446,
            0.08012604681941936,
            0.10989219604629322,
            0.1418469141035297,
            0.12695796813109397,
            0.11633668210517348,
            0.11248154921973649,
            0.08617092330345229,
            0.0838377673215088,
            0.11376388298457919,
            0.09841220630244407,
            0.11280865580836588,
            0.12886015283935764,
            0.09602193069797246,
            0.11961235057570327,
            0.09554998291923249,
            0.08249827610820608,
            0.09220563532266128,
            0.07652346643657652,
            0.08054089370259306,
            0.0773874441061998,
            0.1049781293260725,
            0.08839309196539515,
            0.10140532991394363,
            0.12725663780272162,
            0.11101899114930303,
            0.10519088795938282,
            0.1054841248964121,
            0.09792895553338987,
            0.09193938864297539,
            0.09493058760237127,
            0.08799019569947866,
            0.09363803047694141,
            0.10389456372375863,
            0.09012469270504858,
            0.13500537182494773,
            0.09948541965482303,
            0.07295534349372103,
            0.07584852181822499,
            0.07299400709182205,
            0.07096980147524086,
            0.11114815099944184,
            0.17057101376777098,
            0.1546546068682452,
            0.11418607604811257,
            0.10378763281269825,
            0.10430235542308258,
            0.08369042095105912,
            0.06983009601347781,
            0.10760410131360999,
            0.11041793852813196,
            0.11180024877593397,
            0.12230071786710517,
            0.11752453447729128,
            0.10911975455828885,
            0.13113676457238546,
            0.09506656549823209,
            0.0942116683901332,
            0.08246669713926558,
            0.0852064125584074,
            0.08722002297586837,
            0.0902568442955096,
            0.10605227296068051,
            0.08662377027298489,
            0.11092040644879289,
            0.10844048080869605,
            0.09194357398100965,
            0.10133839276627521,
            0.10910823213944015,
            0.10892513134465527,
            0.11169842788255518,
            0.11208413032814199,
            0.10458042903522743,
            0.11897153259356257,
            0.1205307593658915,
            0.11781939025611415,
            0.1467878237634352,
            0.09883606128071527,
            0.08483617838394793,
            0.07150938214158913,
            0.07020608134646568,
            0.10313391020617081,
            0.17064206407717883,
            0.1671170833615278,
            0.12256947361677187,
            0.08580414513900265,
            0.10760111364753722,
            0.1075232875557481,
            0.06753356949689164,
            0.09049700915833925,
            0.09015308776190321,
            0.11359707249925215,
            0.11884064530334057,
            0.0921749286639732,
            0.13932775989347243,
            0.1062401699704754,
            0.08023271153959002,
            0.07752020023182267,
            0.08173905463243011,
            0.08369480149740768,
            0.07931432075049391,
            0.10808299494475128,
            0.09750938099793739,
            0.10235197045373814,
            0.10426787559823902,
            0.08917897359667021,
            0.0932345306499303,
            0.10111064478486209,
            0.10128460728029151,
            0.10214929225331629,
            0.10782189473101866,
            0.10322067172618164,
            0.10483623811940011,
            0.12216130391979509,
            0.11795350716282318,
            0.14269292012675294,
            0.1121640256716086,
            0.09447618828174771,
            0.07908117032550008,
            0.0710863832203091,
            0.08309876254164979,
            0.14625812010827902,
            0.1610031931160612,
            0.11628505234009781,
            0.07831931800529,
            0.09083366605817868,
            0.11892400699144354,
            0.094667745420799,
            0.07480974764566138,
            0.06398533188470923,
            0.07054336208035249,
            0.09136064941256934,
            0.11982855310148677,
            0.11942271539274958,
            0.1254128259690361,
            0.1638458518216413,
            0.10295724476030758,
            0.07757092656380227,
            0.07497951268338304,
            0.07991810911926718,
            0.08437358783355454,
            0.10754581360704864,
            0.1274783160296671,
            0.11164866824938026,
            0.11216507793471425,
            0.1043316929726203,
            0.10126351239888064,
            0.1030899959807665,
            0.09503854954943239,
            0.10313210964845586,
            0.1049853712714184,
            0.10336078231899119,
            0.09681863223514922,
            0.10675610999620153,
            0.1208489732707866,
            0.1302218868665336,
            0.12975532211562812,
            0.0953480891518595,
            0.09095559608166913,
            0.07794012450951604,
            0.07971297464767636,
            0.10960852107431768,
            0.16155070141861394,
            0.13635775431846525,
            0.09762960244778802,
            0.10060219296614474,
            0.12263315743349062,
            0.12676888613210452,
            0.12491866397510629,
            0.08965214195021726,
            0.10572318184674255,
            0.13491848932718697,
            0.13692249365080583,
            0.12005810639893015,
            0.15772067848717125,
            0.1613423008484053,
            0.10107253766226043,
            0.08189402678374998,
            0.08566595689081592,
            0.0935429018694898,
            0.10727784235895216,
            0.13914489855717527,
            0.13117104503643093,
            0.11805359139620014,
            0.1134893088572864,
            0.11497463740806944,
            0.10909046343447007,
            0.10505989829497248,
            0.11996769189540599,
            0.12269424222695988,
            0.13186740342241232,
            0.1211321643599054,
            0.10840298338118332,
            0.11631860228265872,
            0.1149621864878758,
            0.12539930275599862,
            0.11278734526614215,
            0.0987762193479395,
            0.0886524459501191,
            0.08894575573817462,
            0.1035236646750519,
            0.158015632947891,
            0.15714106906315975,
            0.11288605974824366,
            0.11121680349439886,
            0.12771608335268406,
            0.14101883298210272,
            0.13007882681714827,
            0.12065773373221485,
            0.08288320005764477,
            0.10375020479694458,
            0.13760554884816129,
            0.11995145969874095,
            0.0887768471083455,
            0.0965203498564954,
            0.15190420436411783,
            0.14857522513814367,
            0.08632367125614994,
            0.0816728899482666,
            0.08703431573466183,
            0.08976007010431741,
            0.10782441614910314,
            0.1275237166152852,
            0.10298101281645343,
            0.09386856111876654,
            0.0942088460031476,
            0.10437680444669019,
            0.10518253000435514,
            0.11658694438683338,
            0.10866570828537361,
            0.10726880725516377,
            0.11125575890425816,
            0.10226165243922669,
            0.10194462520373923,
            0.11376553273665294,
            0.10784665340563301,
            0.1035913949030827,
            0.09071133818835327,
            0.08164307817075972,
            0.07967241781716296,
            0.0977876851326139,
            0.13061378636982646,
            0.1685603494181542,
            0.11862621689126507,
            0.10267583589041525,
            0.11684513248063315,
            0.13153277312493875,
            0.1231447352383408,
            0.12360818944696683,
            0.08247431228157133,
            0.11112043655532854,
            0.0986736385179058,
            0.07328718604987784,
            0.06914134529905303,
            0.11016904578777158,
            0.16019698956079986,
            0.11678654560201163,
            0.07824289352071963,
            0.0680062262802707,
            0.06638212968358215,
            0.08003695190939113,
            0.10668313062014044,
            0.08863305659170373,
            0.07309156360046967,
            0.0595071359704259,
            0.06760223144528717,
            0.10310911590736178,
            0.11648606768113144,
            0.10005400102725417,
            0.08574831486613825,
            0.08636370599371651,
            0.07444091757898792,
            0.06943683220553636,
            0.08223445999387433,
            0.10269104208945865,
            0.09328607359317367,
            0.08319804425280215,
            0.08383173895728152,
            0.0794976241244748,
            0.09100305846279635,
            0.10466963432372808,
            0.13438913991570642,
            0.11520907025467561,
            0.08632493952981049,
            0.07958628933423638,
            0.1082854016790884,
            0.11948503624725007,
            0.08654160935260002,
            0.06711917250757143,
            0.06273374836722845,
            0.09208596723628605,
            0.1026242309068843,
            0.07214614265876251,
            0.06681334099237844,
            0.08335549754541509,
            0.13612047154690188,
            0.1463625751199612,
            0.08033047943016525,
            0.057849422580473556,
            0.058012957390995316,
            0.06956983277288148,
            0.09656549325461247,
            0.09984090007025849,
            0.07666255963584176,
            0.06343188414249164,
            0.05175012364665553,
            0.0828567188183634,
            0.125992288731213,
            0.12367798295639895,
            0.0914285609719267,
            0.08281392250454886,
            0.07661311999616939,
            0.05759161359655329,
            0.0646530052155247,
            0.08700556347756043,
            0.08977942509509881,
            0.0694467547313748,
            0.0691770569362997,
            0.07774277855645041,
            0.09155911248194112,
            0.11111607564769599,
            0.12223816389974598,
            0.1264950702901758,
            0.08834074053732288,
            0.06422983889360019,
            0.07627182743324301,
            0.11908817130606,
            0.08621968640364375,
            0.03960872647110551
          ]
        }
      ],
      "transform": [
        {"type": "formula", "expr": "columns", "as": "width"},
        {"type": "formula", "expr": "rows", "as": "height"},
        {
          "type": "formula",
          "expr": "pluck(data('umatrix'),'d')",
          "as": "values"
        },
        {
          "type": "isocontour",
          "scale": {"expr": "hivewidth/datum.width"},
          "translate": [
            {"signal": "(width - hivewidth)/2"},
            {"signal": "(height - (hivewidth*rows/columns))/2"}
          ]
        }
      ]
    }
  ],
  "legends": [
    {
      "title": "Classes",
      "orient": "right",
      "fill": "color",
      "labelColor": "#eee",
      "titleColor": "#eee",
      "encode": {
        "labels": {"update": {"opacity": {"signal": "showClasses ? 1 :0"}}},
        "symbols": {"update": {"opacity": {"signal": "showClasses ? 1 :0"}}},
        "title": {"update": {"opacity": {"signal": "showClasses ? 1 :0"}}}
      }
    }
  ],
  "scales": [
    {
      "name": "hscale",
      "type": "band",
      "domain": {"signal": "sequence(0,max(rows,columns)+1,1)"},
      "range": [0, {"signal": "sizeref*scale"}]
    },
    {
      "name": "g-color",
      "domain": {"data": "umatrix", "field": "d"},
      "range": {"scheme": "viridis"}
    },
    {
      "name": "color",
      "type": "ordinal",
      "domainMin": 0,
      "domain": {"data": "umatrix", "field": "class", "sort": true},
      "range": {"scheme": "category20"}
    },
    {
      "name": "iso-color",
      "type": "linear",
      "domain": {"data": "umatrix", "field": "d"},
      "range": {"scheme": "blueorange"}
    }
  ],
  "marks": [
    {
      "type": "path",
      "from": {"data": "contours"},
      "encode": {
        "enter": {
          "stroke": {"value": "#ccc"},
          "strokeWidth": {"value": 1},
          "fill": {"scale": "iso-color", "field": "contour.value"}
        },
        "update": {"opacity": {"signal": "showIso ? 1 :0"}}
      },
      "transform": [{"type": "geopath", "field": "datum.contour"}]
    },
    {
      "type": "symbol",
      "from": {"data": "umatrix"},
      "encode": {
        "enter": {
          "shape": {"value": "m0,-1 l1,.5 v1 l-1,.5 l-1,-.5 v-1 l1,-.5"},
          "stroke": {"value": "#777"}
        },
        "update": {
          "size": {"signal": "pow(sizeSymbol,2)"},
          "tooltip": [
            {
              "test": "!showIso && !showClasses",
              "signal": "{'class':datum.class,'score':datum.score,'score max':datum.score1, 'score 2':datum.score2,'coords':[datum.x,datum.y]}"
            }
          ],
          "opacity": {"signal": "showIso ? 0 : 1"},
          "xc": {
            "field": "x",
            "scale": "hscale",
            "offset": {
              "signal": "(datum.y%2==1 ? 0 : sizeSymbol/2) + (width - sizeSymbol*columns)/2 + sizeSymbol/4"
            }
          },
          "fill": [
            {
              "test": "showClasses && datum.class >-1",
              "signal": "datum.secondary > -1 ? datum.secondary : datum.class",
              "scale": "color"
            },
            {"test": "showClasses && datum.class == -1", "value": "#555"},
            {"field": "d", "scale": "g-color"}
          ],
          "yc": {
            "field": "y",
            "scale": "hscale",
            "offset": {
              "signal": "(datum.y > 0 ? -datum.y*sizeSymbol/4 : 0) +(height - (sizeSymbol*rows - (rows-1)*sizeSymbol/4))/2 + sizeSymbol/2"
            }
          }
        }
      }
    },
    {
      "type": "symbol",
      "from": {"data": "umatrix"},
      "encode": {
        "enter": {
          "shape": {"value": "m0,-1 l1,.5 v1 l-1,.5 l-1,-.5 v-1 l1,-.5"}
        },
        "update": {
          "opacity": {"signal": "showIso || !showClasses ? 0 :1"},
          "tooltip": [
            {
              "test": "showClasses",
              "signal": "{'class':datum.class,'score':datum.score,'score max':datum.score1, 'score 2':datum.score2,'coords':[datum.x,datum.y]}"
            }
          ],
          "size": {
            "signal": "pow(0.95*sizeSymbol * (datum.score1/(datum.score || 1)||1),2)"
          },
          "xc": {
            "field": "x",
            "scale": "hscale",
            "offset": {
              "signal": "(datum.y%2==1 ? 0 : sizeSymbol/2) + (width - sizeSymbol*columns)/2 + sizeSymbol/4"
            }
          },
          "fill": [
            {
              "test": "showClasses && datum.class > -1",
              "field": "class",
              "scale": "color"
            },
            {"test": "showClasses && datum.class == -1", "value": "#555"},
            {"value": null}
          ],
          "yc": {
            "field": "y",
            "scale": "hscale",
            "offset": {
              "signal": "(datum.y > 0 ? -datum.y*sizeSymbol/4 : 0) +(height - (sizeSymbol*rows - (rows-1)*sizeSymbol/4))/2 + sizeSymbol/2"
            }
          }
        }
      }
    }
  ]
}